<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <title>演讲练习- 泰拉演讲团</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:"PingFang SC","Microsoft YaHei",sans-serif}
        body{background:#f5f5f5;color:#333}
        header{background:#001529;color:#fff;display:flex;align-items:center;padding:0 20px;height:56px}
        header .brand{font-size:18px;font-weight:bold;margin-right:40px}
        header nav a{color:#fff;margin-right:20px;text-decoration:none;font-size:14px}
        header nav a.active{color:#1890ff}
        .sub-nav{background:#fff;border-bottom:1px solid #e8e8e8;padding:12px 20px;font-size:14px}
        .container{max-width:1200px;margin:20px auto;padding:0 20px}
        .card{background:#fff;border-radius:4px;padding:20px}
        .toolbar{display:flex;align-items:center;margin-bottom:16px}
        .toolbar input{width:240px;padding:6px 10px;border:1px solid #d9d9d9;border-radius:2px;margin-right:12px}
        .btn{padding:6px 14px;border:none;border-radius:2px;font-size:14px;cursor:pointer}
        .btn-primary{background:#1890ff;color:#fff}
        .btn-danger{background:#ff4d4f;color:#fff}
        table{width:100%;border-collapse:collapse;font-size:14px}
        th,td{padding:10px 12px;border:1px solid #e8e8e8;text-align:left}
        th{background:#fafafa}
        .header-bar {
            background:#f8f9fa;
            border-bottom:1px solid #dee2e6;
            padding:12px 0;
            position:sticky;
            top:0;
            z-index:1000;
        }
        .filter-group .btn{
            margin-right:6px;
        }
        .question-card{
            margin-bottom:1rem;
            cursor:pointer;
            transition:background .2s;
        }
        .question-card:hover{
            background:#f1f3f5;
        }
    </style>
</head>
<body>
<!-- 顶部主导航 -->
<header>
    <div class="brand">泰拉演讲团</div>
    <nav>
        <a href="ListenerHomepage.html">首页</a>
        <a href="History.html">历史演讲</a>
        <a href="PersonInfo.html">个人信息</a>
    </nav>
</header>

<!-- 顶部导航 -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">演讲练习</span>
        <div>
            <a href="ListenerFavor.html" class="btn btn-outline-secondary btn-sm me-2">我的收藏</a>
            <a href="ListenerFeedback.html" class="btn btn-outline-secondary btn-sm me-2">反馈</a>
        </div>
    </div>
</nav>

<!-- 筛选栏 -->
<div class="container-fluid header-bar">
    <div class="row">
        <div class="col filter-group">
            <!-- 可以添加筛选功能 -->
        </div>
    </div>
</div>

<!-- 题目列表 -->
<div class="container mt-3">
    <h3>进行中的题目</h3>
    <div id="ongoingQuestions">
        <!-- 进行中的题目将被 JS 渲染到这里 -->
    </div>
    <hr>
    <h3>已结束的题目</h3>
    <div id="finishedQuestions">
        <!-- 已结束的题目将被 JS 渲染到这里 -->
    </div>
</div>

<script>
    // 获取 URL 中的查询参数
    const urlParams = new URLSearchParams(window.location.search);
    const listenerID = urlParams.get('ListenerID');
    const speechID = urlParams.get('SpeechID');

    // 输出获取到的参数
    console.log("ListenerID:", listenerID);
    console.log("SpeechID:", speechID);

    // 获取进行中的题目
    fetch(`http://localhost:8081/api/questions/listener/getOpeningQuestions?speechID=${speechID}&listenerID=${listenerID}`)
        .then(response => response.json())
        .then(data => renderQuestions(data, 'ongoingQuestions'))  // 渲染进行中的题目
        .catch(error => console.error('Error fetching ongoing questions:', error));

    // 获取已结束的题目
    fetch(`http://localhost:8081/api/questions/listener/getfinishedQuestions?speechID=${speechID}&listenerID=${listenerID}`)
        .then(response => response.json())
        .then(data => renderQuestions(data, 'finishedQuestions'))  // 渲染已结束的题目
        .catch(error => console.error('Error fetching finished questions:', error));

    // 渲染题目的函数
    // 渲染题目列表

    function renderQuestions(questions, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        questions.forEach(question => {
            const card = document.createElement('div');
            card.className = 'card question-card';
            card.innerHTML = `
            <div class="card-body">
                <p class="card-text">${question.questioncontent}</p>
                <button class="btn btn-primary btn-sm">进入</button>
            </div>
        `;

            // 动态绑定事件
            const btn = card.querySelector('button');
            btn.addEventListener('click', () => saveQuestionAndRedirect(question));

            container.appendChild(card);
        });
    }

    // 保存数据到 sessionStorage 并跳转到详情页
    function saveQuestionAndRedirect(question) {
        // 将 question 对象存储到 sessionStorage 中
        sessionStorage.setItem('questionData', JSON.stringify(question));  // 存储 question 对象
        // 跳转到 QuestionDetail.html 页面
        window.location.href = `QuestionDetail.html?listenerID=${listenerID}`;  // 跳转到详情页
    }



</script>
</body>
</html>
